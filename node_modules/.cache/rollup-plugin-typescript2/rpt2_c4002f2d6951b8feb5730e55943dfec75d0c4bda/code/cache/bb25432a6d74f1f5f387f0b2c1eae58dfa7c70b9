{"code":"import { sendRequest } from \"@/colony/dpt_comunication\";\r\nconst roles = {\r\n    manager: (data) => ({\r\n        source: creep => {\r\n            return true;\r\n        },\r\n        target: creep => {\r\n            return false;\r\n        }\r\n    }),\r\n    worker: (data) => ({\r\n        source: creep => {\r\n            const task = creep.memory['task'];\r\n            if (task['target']['id'] == null) {\r\n                if (creep.memory['waiting'])\r\n                    creep.say('zz');\r\n                else {\r\n                    sendRequest(creep.memory['roomName'], 'dpt_work', creep.name);\r\n                    creep.memory['waiting'] = true; //dpt_work will change to false\r\n                }\r\n                return false;\r\n            }\r\n            else {\r\n                const taskType = task['type'];\r\n                return workerTaskOperation[taskType].source(creep);\r\n            }\r\n        },\r\n        target: creep => {\r\n            const taskType = creep.memory['task']['type'];\r\n            return workerTaskOperation[taskType].target(creep);\r\n        }\r\n    }),\r\n    transporter: (data) => ({\r\n        source: creep => {\r\n            const taskType = creep.memory['task']['type'];\r\n            if (taskType) {\r\n                return transferTaskOperations[taskType].source(creep);\r\n            }\r\n            else {\r\n                //send task \r\n                if (creep.memory['sendTaskRequest']) {\r\n                    creep.say('💤');\r\n                }\r\n                else {\r\n                    creep.say('✉️');\r\n                    sendRequest(creep.memory['roomName'], 'dpt_logistic', creep.name);\r\n                    creep.memory['sendTaskRequest'] = true;\r\n                }\r\n                return false;\r\n            }\r\n        },\r\n        target: creep => {\r\n            const taskType = creep.memory['task']['type'];\r\n            if (taskType) {\r\n                console.log(1111);\r\n                return transferTaskOperations[taskType].target(creep);\r\n            }\r\n            else\r\n                return true; //get new task\r\n        }\r\n    })\r\n};\r\nexport const transferTaskOperations = {\r\n    MOVE: {\r\n        source: (creep) => {\r\n            creep.say('💤');\r\n            return false;\r\n        },\r\n        target: (creep) => {\r\n            return false;\r\n        }\r\n    },\r\n    TRANSFER: {\r\n        source: (creep) => {\r\n            const source = Game.getObjectById(creep.memory['task']['source']);\r\n            //CHECK IF CREEP STORAGE IS EMPTY\r\n            //@ts-ignore\r\n            if (creep.withdraw(source, creep.memory['task']['target']['resourceType']) == ERR_NOT_IN_RANGE) { //@ts-ignore\r\n                creep.moveTo(source);\r\n            }\r\n            return creep.store.getFreeCapacity() <= 0;\r\n        },\r\n        target: (creep) => {\r\n            const target = Game.getObjectById(creep.memory['task']['target']['id']);\r\n            if (target) { //@ts-ignore\r\n                const transfer = creep.transfer(target, creep.memory['task']['target']['resourceType']);\r\n                const creepStorageIni = creep.store.getUsedCapacity();\r\n                if (transfer == ERR_NOT_IN_RANGE) {\r\n                    //const pos = new RoomPosition(creep.memory['task']['target']['pos'][0], creep.memory['task']['target']['pos'][1], creep.memory['task']['target']['roomName']);\r\n                    //@ts-ignore\r\n                    creep.moveTo(target);\r\n                }\r\n                else if (transfer == OK) {\r\n                    creep.memory['amountDone'] = creep.memory['amountDone'] + creepStorageIni;\r\n                }\r\n                const amountNeeded = creep.memory['task']['target']['amount'];\r\n                if (amountNeeded != -1) {\r\n                    if (creep.memory['amountDone'] >= amountNeeded) { //task complete\r\n                        creep.memory['task']['type'] = null;\r\n                        return true;\r\n                    }\r\n                    else\r\n                        return (creep.store.getUsedCapacity() <= 0);\r\n                }\r\n                else\r\n                    return (creep.store.getUsedCapacity() <= 0);\r\n            }\r\n            else { //reset task\r\n                creep.memory['task']['type'] = null;\r\n                creep.memory['sendTaskRequest'] = false;\r\n                creep.say('❌');\r\n                return true;\r\n            }\r\n        }\r\n    },\r\n    WITHDRAW: {\r\n        source: (creep) => {\r\n            return false;\r\n        },\r\n        target: (creep) => {\r\n            return false;\r\n        }\r\n    }\r\n};\r\nexport const workerTaskOperation = {\r\n    BUILD: {\r\n        source: (creep) => {\r\n            const pos = creep.memory['task']['target']['pos'];\r\n            const targetPos = new RoomPosition(pos[0], pos[1], creep.memory['roomName']);\r\n            if (creep.pos.inRangeTo(targetPos, 3))\r\n                return true;\r\n            else\r\n                return false;\r\n        },\r\n        target: (creep) => {\r\n            const target = Game.getObjectById(creep.memory['task']['target']['id']);\r\n            if (target) { //@ts-ignore\r\n                creep.build(target);\r\n                return false;\r\n            }\r\n            else {\r\n                //notify contruction completation\r\n            }\r\n        }\r\n    },\r\n    REPAIR: {\r\n        source: (creep) => {\r\n            return false;\r\n        },\r\n        target: (creep) => {\r\n            return false;\r\n        }\r\n    }\r\n};\r\nexport default roles;\r\n//# sourceMappingURL=advanced.js.map","references":["C:/Users/heche/AppData/Local/Screeps/scripts/127_0_0_1___21025/Winsnow/src/colony/dpt_comunication.ts","C:/Users/heche/AppData/Local/Screeps/scripts/127_0_0_1___21025/Winsnow/src/roomPlanning/planningUtils.ts"],"map":"{\"version\":3,\"file\":\"advanced.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/creep/role/advanced.ts\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAE,WAAW,EAAE,MAAM,2BAA2B,CAAC;AAKxD,MAAM,KAAK,GAEP;IAGA,OAAO,EAAE,CAAC,IAAY,EAAgB,EAAE,CAAC,CAAC;QACtC,MAAM,EAAE,KAAK,CAAC,EAAE;YAEZ,OAAO,IAAI,CAAC;QAChB,CAAC;QACD,MAAM,EAAE,KAAK,CAAC,EAAE;YAEZ,OAAO,KAAK,CAAC;QACjB,CAAC;KACJ,CAAC;IAEF,MAAM,EAAE,CAAC,IAAY,EAAgB,EAAE,CAAC,CAAC;QACrC,MAAM,EAAE,KAAK,CAAC,EAAE;YACZ,MAAM,IAAI,GAAG,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;YAClC,IAAI,IAAI,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,IAAI,IAAI,EAAE;gBAC9B,IAAI,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC;oBAAG,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;qBACzC;oBACD,WAAW,CAAC,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,EAAE,UAAU,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;oBAC9D,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,GAAG,IAAI,CAAC,CAAQ,+BAA+B;iBACzE;gBACD,OAAO,KAAK,CAAC;aAChB;iBACI;gBACD,MAAM,QAAQ,GAAkB,IAAI,CAAC,MAAM,CAAC,CAAC;gBAC7C,OAAO,mBAAmB,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAA;aACrD;QAEL,CAAC;QACD,MAAM,EAAE,KAAK,CAAC,EAAE;YACZ,MAAM,QAAQ,GAAG,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,CAAC;YAE9C,OAAO,mBAAmB,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QACvD,CAAC;KACJ,CAAC;IAEF,WAAW,EAAE,CAAC,IAAQ,EAAgB,EAAE,CAAC,CAAC;QACtC,MAAM,EAAE,KAAK,CAAC,EAAE;YAEZ,MAAM,QAAQ,GAAG,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,CAAC;YAC9C,IAAI,QAAQ,EAAE;gBACV,OAAO,sBAAsB,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAA;aACxD;iBACI;gBACD,YAAY;gBACZ,IAAI,KAAK,CAAC,MAAM,CAAC,iBAAiB,CAAC,EAAE;oBACjC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,CAAA;iBAClB;qBACI;oBACD,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,CAAA;oBACf,WAAW,CAAC,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,EAAE,cAAc,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;oBAClE,KAAK,CAAC,MAAM,CAAC,iBAAiB,CAAC,GAAG,IAAI,CAAC;iBAC1C;gBACD,OAAO,KAAK,CAAC;aAChB;QAEL,CAAC;QACD,MAAM,EAAE,KAAK,CAAC,EAAE;YAGZ,MAAM,QAAQ,GAAU,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,CAAC;YAErD,IAAI,QAAQ,EAAE;gBACV,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;gBAElB,OAAO,sBAAsB,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAA;aACxD;;gBACI,OAAO,IAAI,CAAC,CAAO,cAAc;QAE1C,CAAC;KACJ,CAAC;CACL,CAAA;AAED,MAAM,CAAC,MAAM,sBAAsB,GAC/B;IACA,IAAI,EAAE;QACF,MAAM,EAAE,CAAC,KAAW,EAAE,EAAE;YACpB,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;YAChB,OAAO,KAAK,CAAC;QACjB,CAAC;QACD,MAAM,EAAE,CAAC,KAAW,EAAE,EAAE;YAEpB,OAAO,KAAK,CAAC;QACjB,CAAC;KAEJ;IACD,QAAQ,EAAE;QACN,MAAM,EAAE,CAAC,KAAW,EAAE,EAAE;YACpB,MAAM,MAAM,GAAG,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAA;YACjE,iCAAiC;YAEjC,YAAY;YACZ,IAAI,KAAK,CAAC,QAAQ,CAAC,MAAM,EAAE,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,QAAQ,CAAC,CAAC,cAAc,CAAC,CAAC,IAAI,gBAAgB,EAAE,EAAC,YAAY;gBACzG,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAA;aACvB;YACD,OAAO,KAAK,CAAC,KAAK,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;QAC9C,CAAC;QACD,MAAM,EAAE,CAAC,KAAW,EAAE,EAAE;YACpB,MAAM,MAAM,GAAG,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;YAExE,IAAI,MAAM,EAAE,EAAK,YAAY;gBACzB,MAAM,QAAQ,GAAG,KAAK,CAAC,QAAQ,CAAC,MAAM,EAAE,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,QAAQ,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC;gBAExF,MAAM,eAAe,GAAG,KAAK,CAAC,KAAK,CAAC,eAAe,EAAE,CAAC;gBACtD,IAAI,QAAQ,IAAI,gBAAgB,EAAE;oBAC9B,+JAA+J;oBAC/J,YAAY;oBACZ,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;iBACxB;qBACI,IAAI,QAAQ,IAAI,EAAE,EAAE;oBACrB,KAAK,CAAC,MAAM,CAAC,YAAY,CAAC,GAAG,KAAK,CAAC,MAAM,CAAC,YAAY,CAAC,GAAG,eAAe,CAAC;iBAC7E;gBAGD,MAAM,YAAY,GAAU,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,QAAQ,CAAC,CAAC,QAAQ,CAAC,CAAC;gBACrE,IAAI,YAAY,IAAI,CAAC,CAAC,EAAE;oBACpB,IAAI,KAAK,CAAC,MAAM,CAAC,YAAY,CAAC,IAAI,YAAY,EAAE,EAAI,eAAe;wBAC/D,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC;wBACpC,OAAO,IAAI,CAAC;qBACf;;wBAAK,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC,CAAC;iBACrD;;oBACI,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC,CAAC;aAEpD;iBACI,EAAG,YAAY;gBAChB,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC;gBACpC,KAAK,CAAC,MAAM,CAAC,iBAAiB,CAAC,GAAG,KAAK,CAAC;gBACxC,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;gBACd,OAAO,IAAI,CAAC;aACf;QAIL,CAAC;KAEJ;IACD,QAAQ,EAAE;QACN,MAAM,EAAE,CAAC,KAAW,EAAE,EAAE;YACpB,OAAO,KAAK,CAAC;QACjB,CAAC;QACD,MAAM,EAAE,CAAC,KAAW,EAAE,EAAE;YACpB,OAAO,KAAK,CAAC;QACjB,CAAC;KAEJ;CAEJ,CAAA;AAED,MAAM,CAAC,MAAM,mBAAmB,GAC5B;IACA,KAAK,EAAE;QACH,MAAM,EAAE,CAAC,KAAY,EAAE,EAAE;YACrB,MAAM,GAAG,GAAG,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,QAAQ,CAAC,CAAC,KAAK,CAAC,CAAC;YAClD,MAAM,SAAS,GAAG,IAAI,YAAY,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,CAAC;YAC7E,IAAI,KAAK,CAAC,GAAG,CAAC,SAAS,CAAC,SAAS,EAAE,CAAC,CAAC;gBAAE,OAAO,IAAI,CAAC;;gBAC9C,OAAO,KAAK,CAAC;QACtB,CAAC;QACD,MAAM,EAAE,CAAC,KAAY,EAAE,EAAE;YACrB,MAAM,MAAM,GAAG,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;YACxE,IAAI,MAAM,EAAE,EAAI,YAAY;gBACxB,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;gBACpB,OAAO,KAAK,CAAC;aAChB;iBACI;gBACD,iCAAiC;aACpC;QACL,CAAC;KACJ;IACD,MAAM,EAAC;QACH,MAAM,EAAE,CAAC,KAAY,EAAE,EAAE;YACrB,OAAO,KAAK,CAAC;QACjB,CAAC;QACD,MAAM,EAAE,CAAC,KAAY,EAAE,EAAE;YACrB,OAAO,KAAK,CAAC;QACjB,CAAC;KACJ;CACJ,CAAA;AAGD,eAAe,KAAK,CAAC\"}"}
